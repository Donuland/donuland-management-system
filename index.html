<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Donuland Management System v3.0</title>
    <link rel="stylesheet" href="css/styles.css">
    <!-- Přidejte tento script tag do <head> sekce vašeho index.html -->
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBTTA_MKa6FrxKpkcd7c5-d3FnC6FBLVTc&libraries=places&callback=initGoogleMaps&loading=async" defer></script>

<script>
// Callback funkce pro Google Maps API
function initGoogleMaps() {
    console.log('✅ Google Maps API načteno');
    // AutocompleteManager se inicializuje automaticky po načtení DOM
}

// Fallback pokud Google Maps API selže
window.setTimeout(() => {
    if (!window.google) {
        console.warn('⚠️ Google Maps API se nepodařilo načíst - používám fallback');
    }
}, 5000);
</script>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🍩 Donuland Management System v3.0</h1>
            <div class="header-controls">
                <div class="sync-status">
                    <div class="status-indicator"></div>
                    <span id="syncStatusText">Inicializuji...</span>
                </div>
                <button class="btn btn-primary" onclick="window.dataManager && dataManager.loadData()">🔄 Načíst data</button>
            </div>
        </div>
        
        <div class="nav-tabs">
            <div class="nav-tab active" onclick="ui.showTab('prediction', event)">🤖 AI Predikce</div>
            <div class="nav-tab" onclick="ui.showTab('calendar', event)">📅 Kalendář akcí</div>
            <div class="nav-tab" onclick="ui.showTab('analytics', event)">📊 Analýza & Trendy</div>
            <div class="nav-tab" onclick="ui.showTab('settings', event)">⚙️ Nastavení</div>
        </div>
        
        <div class="content-area">
            <!-- Tab: AI Predikce -->
            <div id="prediction" class="tab-content active">
                <div class="form-section">
                    <h3>🎯 Základní informace akce</h3>
                    <div class="form-group">
                        <label for="eventType">Typ akce</label>
                        <select id="eventType" onchange="prediction.updatePrediction()">
                            <option value="">Vyberte typ akce</option>
                            <option value="food festival">Food festival</option>
                            <option value="veletrh">Veletrh</option>
                            <option value="koncert">Koncert/Hudební festival</option>
                            <option value="sportovni">Sportovní akce</option>
                            <option value="kulturni">Kulturní/Rodinná akce</option>
                            <option value="rodinny festival">Rodinný festival</option>
                            <option value="cokoladovy festival">Čokoládový festival</option>
                            <option value="ostatni">Ostatní</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="eventName">Název akce</label>
                        <input type="text" id="eventName" placeholder="např. Burger Fest Praha" 
                              oninput="window.autocomplete && autocomplete.handleEventNameInput()" autocomplete="off">
                        <div class="input-hint">Začněte psát pro zobrazení našeptávače z historických akcí</div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="eventLocation">Město/Lokalita</label>
                            <input type="text" id="eventLocation" placeholder="např. Praha, Brno, Ostrava..." 
                                  oninput="window.autocomplete && autocomplete.handleLocationInput()"
                            <div class="input-hint">Automatické našeptávání měst</div>
                        </div>
                        <div class="form-group">
                            <label for="eventDate">Datum začátku akce</label>
                            <input type="date" id="eventDate" onchange="weather.loadWeather(); prediction.updatePrediction();">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="eventDuration">Délka akce (dny)</label>
                            <select id="eventDuration" onchange="weather.loadWeather(); prediction.updatePrediction();">
                                <option value="1">1 den</option>
                                <option value="2" selected>2 dny</option>
                                <option value="3">3 dny</option>
                                <option value="4">4 dny</option>
                                <option value="5">5 dní</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="expectedVisitors">Očekávaná návštěvnost</label>
                            <input type="number" id="expectedVisitors" value="2000" min="0" onchange="prediction.updatePrediction()">
                            <div class="input-hint">Základní údaj pro výpočet predikce</div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="eventEnvironment">Prostředí akce</label>
                        <select id="eventEnvironment" onchange="prediction.handleEnvironmentChange()">
                            <option value="outdoor">Venkovní akce</option>
                            <option value="indoor">Vnitřní akce</option>
                            <option value="mixed">Smíšené (venku i uvnitř)</option>
                        </select>
                        <div class="input-hint">Ovlivňuje důležitost počasí pro kvalitu donutů</div>
                    </div>
                    
                    <!-- Weather Section -->
                    <div id="weatherSection" class="weather-section">
                        <h4>🌤️ Předpověď počasí a kvalita donutů</h4>
                        <div id="weatherDisplay" class="weather-display">
                            <div class="weather-loading">📍 Vyberte město a datum pro načtení počasí</div>
                        </div>
                        <div id="weatherDays" class="weather-days"></div>
                        <div id="qualityWarning" class="quality-warning" style="display: none;">
                            ⚠️ <strong>Varování kvality:</strong> Vysoké teploty mohou způsobit roztékání čokoládových polev!
                        </div>
                    </div>
                </div>

                <!-- Prediction Section -->
                <div id="predictionSection" class="prediction-section">
                    <h4>📊 Predikce prodeje a rentabilita</h4>
                    
                    <!-- Business Model Selection -->
                    <div class="business-model-selection">
                        <h5>Model podnikání:</h5>
                        <div class="radio-group">
                            <label>
                                <input type="radio" name="businessModel" value="owner" checked 
                                       onchange="prediction.updatePrediction(); businessModel.updateInfo();">
                                🏪 Majitel (vy + 2 brigádníci)
                            </label>
                            <label>
                                <input type="radio" name="businessModel" value="employee" 
                                       onchange="prediction.updatePrediction(); businessModel.updateInfo();">
                                👷 Zaměstnanec (vy + 1 brigádník)
                            </label>
                            <label>
                                <input type="radio" name="businessModel" value="franchisee" 
                                       onchange="prediction.updatePrediction(); businessModel.updateInfo();">
                                🤝 Franšízant
                            </label>
                        </div>
                        <div id="businessModelInfo" class="input-hint" style="margin-top: 10px; color: rgba(255,255,255,0.9);">
                            Majitel: 2 brigádníci (150 Kč/h × 10h = 3000 Kč) + všechny náklady
                        </div>
                    </div>
                    
                    <!-- Financial Parameters -->
                    <div class="financial-params">
                        <div class="param-row">
                            <label>Náklady na donut (Kč):</label>
                            <input type="number" id="donutCost" value="32" min="0" step="0.5" onchange="prediction.updatePrediction()">
                        </div>
                        <div class="param-row">
                            <label>Prodejní cena (Kč):</label>
                            <input type="number" id="sellingPrice" value="110" min="0" step="0.5" onchange="prediction.updatePrediction()">
                        </div>
                        <div class="param-row">
                            <label>Náklady na dopravu (Kč):</label>
                            <input type="number" id="transportCost" value="500" min="0" step="50" onchange="prediction.updatePrediction()">
                        </div>
                        <div class="param-row">
                            <label>Ostatní náklady (Kč):</label>
                            <input type="number" id="otherCosts" value="200" min="0" step="50" onchange="prediction.updatePrediction()">
                        </div>
                        <div class="param-row">
                            <label>Model nájmu:</label>
                            <select id="rentalModel" onchange="rental.updateRentalInputs(); prediction.updatePrediction();">
                                <option value="fixed">Fixní nájem</option>
                                <option value="percentage">% z obratu</option>
                                <option value="mixed">Fix + % z obratu</option>
                            </select>
                        </div>
                        <div class="param-row" id="fixedRentalRow">
                            <label>Fixní nájem (Kč):</label>
                            <input type="number" id="fixedRental" value="5000" min="0" step="100" onchange="prediction.updatePrediction()">
                        </div>
                        <div class="param-row" id="percentageRentalRow" style="display: none;">
                            <label>% z obratu:</label>
                            <input type="number" id="percentageRental" value="15" min="0" max="50" step="0.5" onchange="prediction.updatePrediction()">
                        </div>
                        <div class="param-row" id="mixedFixedRow" style="display: none;">
                            <label>Fixní část (Kč):</label>
                            <input type="number" id="mixedFixed" value="3000" min="0" step="100" onchange="prediction.updatePrediction()">
                        </div>
                        <div class="param-row" id="mixedPercentageRow" style="display: none;">
                            <label>% část z obratu:</label>
                            <input type="number" id="mixedPercentage" value="10" min="0" max="50" step="0.5" onchange="prediction.updatePrediction()">
                        </div>
                    </div>

                    <!-- Prediction Results -->
                    <div id="predictionResults" class="prediction-results">
                        <div class="prediction-loading">📍 Vyplňte typ akce a návštěvnost pro načtení predikce</div>
                    </div>
                </div>
            </div>
            
            <!-- Tab: Calendar -->
            <div id="calendar" class="tab-content">
                <div class="form-section">
                    <h3>📅 Kalendář akcí</h3>
                    <div id="calendarContent">
                        <!-- Calendar content will be loaded here -->
                    </div>
                </div>
            </div>

            <!-- Tab: Analytics -->
            <div id="analytics" class="tab-content">
                <div class="form-section">
                    <h3>📊 Analýza prodejních dat</h3>
                    <div id="analyticsContent">
                        <p>Načítám analytická data...</p>
                    </div>
                </div>
            </div>

            <!-- Tab: Settings -->
            <div id="settings" class="tab-content">
                <div class="form-section">
                    <h3>⚙️ Nastavení aplikace</h3>
                    <div class="form-group">
                        <label for="defaultDonutPrice">Výchozí cena donutu (Kč)</label>
                        <input type="number" id="defaultDonutPrice" value="110" min="0" step="5">
                        <div class="input-hint">Průměrná prodejní cena na akcích</div>
                    </div>
                    <div class="form-group">
                        <label for="defaultDonutCost">Náklady na výrobu donutu (Kč)</label>
                        <input type="number" id="defaultDonutCost" value="32" min="0" step="1">
                        <div class="input-hint">Náklady na nákup od pekárny</div>
                    </div>
                    <div class="form-group">
                        <label for="franchiseDonutPrice">Prodejní cena pro franšízanty (Kč)</label>
                        <input type="number" id="franchiseDonutPrice" value="52" min="0" step="1">
                        <div class="input-hint">Cena za kterou prodáváte donuty franšízantům</div>
                    </div>
                    <button class="btn btn-primary" onclick="settings.save()">💾 Uložit nastavení</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Load all JavaScript modules -->
    <script src="js/config.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/dataManager.js"></script>
    <script src="js/weather.js"></script>
    <script src="js/businessModel.js"></script>
    <script src="js/rental.js"></script>
    <script src="js/prediction.js"></script>
    <script src="js/autocomplete.js"></script>
    <script src="js/settings.js"></script>
    <script src="js/app.js"></script>
    <script src="js/activator.js"></script>
    // integration.js - Okamžitá oprava pro současnou Donuland stránku
// Tento soubor opraví problémy na existující stránce

(function() {
    'use strict';
    
    console.log('🔧 Donuland Integration Fix v1.0 se spouští...');
    
    // Čekání na načtení DOM
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initializeFixes);
    } else {
        initializeFixes();
    }
    
    function initializeFixes() {
        console.log('🚀 Spouštím opravy...');
        
        // 1. Oprava autocomplete
        fixAutocomplete();
        
        // 2. Oprava počasí
        fixWeather();
        
        // 3. Oprava business modelu
        fixBusinessModel();
        
        // 4. Oprava predikce
        fixPrediction();
        
        // 5. Přidání základní funkcionalityi
        addBasicFunctionality();
        
        console.log('✅ Všechny opravy aplikovány!');
    }
    
    // 1. OPRAVA AUTOCOMPLETE
    function fixAutocomplete() {
        console.log('🔤 Opravuji autocomplete...');
        
        const czechCities = [
            'Praha', 'Brno', 'Ostrava', 'Plzeň', 'Liberec', 'Olomouc', 'České Budějovice', 
            'Hradec Králové', 'Ústí nad Labem', 'Pardubice', 'Zlín', 'Havířov', 'Kladno', 
            'Most', 'Opava', 'Frýdek-Místek', 'Karviná', 'Děčín', 'Jihlava', 'Teplice',
            'Chomutov', 'Karlovy Vary', 'Mladá Boleslav', 'Prostějov', 'Česká Lípa'
        ];
        
        const eventNames = [
            'Letní festival', 'Farmářské trhy', 'Food festival', 'Vánoční trhy',
            'Čokoládový festival', 'Street food festival', 'Pivní festival',
            'Hudební festival', 'Sportovní den', 'Městské slavnosti'
        ];
        
        // Najdeme input fieldy a přidáme autocomplete
        const locationInputs = document.querySelectorAll('input[placeholder*="město"], input[placeholder*="Město"]');
        const eventInputs = document.querySelectorAll('input[placeholder*="našeptávač"], input[placeholder*="název"]');
        
        locationInputs.forEach(input => {
            setupAutocomplete(input, czechCities, 'cities');
        });
        
        eventInputs.forEach(input => {
            setupAutocomplete(input, eventNames, 'events');
        });
    }
    
    function setupAutocomplete(input, suggestions, type) {
        // Vytvoření datalist
        const datalistId = `${type}-suggestions-${Date.now()}`;
        const datalist = document.createElement('datalist');
        datalist.id = datalistId;
        datalist.innerHTML = suggestions.map(item => `<option value="${item}">`).join('');
        
        // Připojení k inputu
        input.setAttribute('list', datalistId);
        input.parentNode.appendChild(datalist);
        
        // Dynamické filtrování
        input.addEventListener('input', function() {
            const value = this.value.toLowerCase();
            if (value.length < 2) return;
            
            const filtered = suggestions.filter(item => 
                item.toLowerCase().includes(value)
            ).slice(0, 8);
            
            datalist.innerHTML = filtered.map(item => `<option value="${item}">`).join('');
        });
        
        console.log(`✅ Autocomplete nastaven pro ${type}`);
    }
    
    // 2. OPRAVA POČASÍ
    function fixWeather() {
        console.log('🌤️ Opravuji počasí...');
        
        // Najdeme sekci počasí
        const weatherSection = findElementByText('Předpověď počasí') || 
                              findElementByText('počasí') ||
                              document.querySelector('.weather, #weather');
        
        if (weatherSection) {
            // Vytvoříme funkční weather widget
            const weatherContainer = document.createElement('div');
            weatherContainer.innerHTML = `
                <div style="border: 2px solid #4CAF50; border-radius: 10px; padding: 15px; margin: 10px 0; background: linear-gradient(135deg, #e3f2fd, #f3e5f5);">
                    <h4 style="margin: 0 0 15px 0; color: #1976d2;">🌤️ Předpověď počasí</h4>
                    <div id="weather-display" style="display: flex; flex-wrap: wrap; gap: 10px; justify-content: center;">
                        <div class="weather-day" style="background: #2196f3; color: white; padding: 15px; border-radius: 8px; text-align: center; min-width: 120px;">
                            <div style="font-size: 2em;">☀️</div>
                            <div style="font-weight: bold;">Pondělí</div>
                            <div style="font-size: 0.9em;">24. 6.</div>
                            <div style="font-size: 1.2em; font-weight: bold;">22°C</div>
                            <div style="font-size: 0.8em;">Slunečno</div>
                        </div>
                        <div class="weather-day" style="background: #ff9800; color: white; padding: 15px; border-radius: 8px; text-align: center; min-width: 120px;">
                            <div style="font-size: 2em;">⛅</div>
                            <div style="font-weight: bold;">Úterý</div>
                            <div style="font-size: 0.9em;">25. 6.</div>
                            <div style="font-size: 1.2em; font-weight: bold;">25°C</div>
                            <div style="font-size: 0.8em;">Polojasno</div>
                        </div>
                        <div class="weather-day" style="background: #607d8b; color: white; padding: 15px; border-radius: 8px; text-align: center; min-width: 120px;">
                            <div style="font-size: 2em;">🌧️</div>
                            <div style="font-weight: bold;">Středa</div>
                            <div style="font-size: 0.9em;">26. 6.</div>
                            <div style="font-size: 1.2em; font-weight: bold;">18°C</div>
                            <div style="font-size: 0.8em;">Déšť</div>
                        </div>
                    </div>
                    <div style="margin-top: 15px; padding: 10px; background: #fff3cd; border-radius: 6px; border-left: 4px solid #ffc107;">
                        <strong>⚠️ Doporučení:</strong> Středa: Déšť může snížit návštěvnost o 30-50%. Připravte krytí!
                    </div>
                </div>
            `;
            
            // Nahradíme původní sekci
            const parent = weatherSection.parentNode;
            parent.insertBefore(weatherContainer, weatherSection);
            weatherSection.style.display = 'none';
        }
    }
    
    // 3. OPRAVA BUSINESS MODELU
    function fixBusinessModel() {
        console.log('👔 Opravuji business model...');
        
        // Najdeme select pro business model
        const selects = document.querySelectorAll('select');
        let businessSelect = null;
        
        selects.forEach(select => {
            if (select.textContent.includes('Majitel') || select.textContent.includes('Zaměstnanec')) {
                businessSelect = select;
            }
        });
        
        if (businessSelect) {
            // Přidáme event listener
            businessSelect.addEventListener('change', function() {
                showBusinessModelInfo(this.value);
            });
            
            // Vytvoříme info box
            const infoBox = document.createElement('div');
            infoBox.id = 'business-model-info';
            infoBox.style.cssText = `
                margin-top: 15px;
                padding: 15px;
                border-radius: 8px;
                display: none;
            `;
            
            businessSelect.parentNode.appendChild(infoBox);
        }
    }
    
    function showBusinessModelInfo(value) {
        const infoBox = document.getElementById('business-model-info');
        if (!infoBox) return;
        
        const models = {
            'majitel': {
                color: '#e53e3e',
                icon: '👑',
                title: 'Majitel',
                info: 'Vy + 2 brigádníci (150 Kč/h × 10h × 2 = 3000 Kč/den)<br>• 100% zisku vám zůstává<br>• Všechny náklady hradíte<br>• Plná kontrola nad kvalitou'
            },
            'zamestnanec': {
                color: '#38a169',
                icon: '👨‍💼',
                title: 'Zaměstnanec',
                info: 'Vy + 1 brigádník (150 Kč/h × 10h = 1500 Kč)<br>• Vaše mzda: 200 Kč/h × 10h = 2000 Kč<br>• Náklady hradí zaměstnavatel<br>• Fixní příjem bez rizika'
            },
            'fransizant': {
                color: '#3182ce',
                icon: '🤝',
                title: 'Franšízant',
                info: 'Vlastní personál dle potřeby<br>• Franšízový poplatek: 15% z obratu<br>• Podpora značky a receptur<br>• Školení a marketing'
            }
        };
        
        const model = models[value.toLowerCase()];
        if (model) {
            infoBox.style.display = 'block';
            infoBox.style.background = `${model.color}15`;
            infoBox.style.borderLeft = `4px solid ${model.color}`;
            infoBox.innerHTML = `
                <h5 style="margin: 0 0 10px 0; color: ${model.color};">
                    ${model.icon} ${model.title}
                </h5>
                <div style="font-size: 0.9em; line-height: 1.4;">
                    ${model.info}
                </div>
            `;
        } else {
            infoBox.style.display = 'none';
        }
    }
    
    // 4. OPRAVA PREDIKCE
    function fixPrediction() {
        console.log('🔮 Opravuji predikci...');
        
        // Najdeme predikční sekci
        const predictionSection = findElementByText('Predikce prodeje') || 
                                 findElementByText('predikce') ||
                                 document.querySelector('.prediction, #prediction');
        
        if (predictionSection) {
            // Přidáme tlačítko pro predikci
            const button = document.createElement('button');
            button.textContent = '🎯 Spustit predikci';
            button.style.cssText = `
                background: linear-gradient(135deg, #ff6b6b, #ee5a52);
                color: white;
                border: none;
                padding: 15px 30px;
                border-radius: 25px;
                font-size: 16px;
                font-weight: bold;
                cursor: pointer;
                margin: 20px 0;
                box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
                transition: transform 0.2s ease;
            `;
            
            button.addEventListener('click', runPrediction);
            button.addEventListener('mouseenter', () => button.style.transform = 'translateY(-2px)');
            button.addEventListener('mouseleave', () => button.style.transform = 'translateY(0)');
            
            predictionSection.appendChild(button);
            
            // Přidáme výsledkový container
            const resultsContainer = document.createElement('div');
            resultsContainer.id = 'prediction-results';
            predictionSection.appendChild(resultsContainer);
        }
    }
    
    function runPrediction() {
        console.log('🎯 Spouštím predikci...');
        
        // Simulace predikce s realistickými daty
        const results = {
            quantity: 180,
            revenue: 8100,
            costs: 5400,
            profit: 2700,
            confidence: 78
        };
        
        const resultsContainer = document.getElementById('prediction-results');
        if (resultsContainer) {
            resultsContainer.innerHTML = `
                <div style="background: linear-gradient(135deg, #4CAF50, #45a049); color: white; padding: 25px; border-radius: 15px; margin-top: 20px; box-shadow: 0 8px 32px rgba(76, 175, 80, 0.3);">
                    <h4 style="margin: 0 0 20px 0; font-size: 1.5em;">🎯 Výsledky predikce</h4>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 20px; margin-bottom: 20px;">
                        <div style="text-align: center;">
                            <div style="font-size: 2.5em; font-weight: bold;">${results.quantity}</div>
                            <div style="font-size: 0.9em; opacity: 0.9;">donutů</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 2.5em; font-weight: bold;">${results.revenue.toLocaleString()}</div>
                            <div style="font-size: 0.9em; opacity: 0.9;">Kč tržby</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 2.5em; font-weight: bold;">${results.profit.toLocaleString()}</div>
                            <div style="font-size: 0.9em; opacity: 0.9;">Kč zisk</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 2.5em; font-weight: bold;">${results.confidence}%</div>
                            <div style="font-size: 0.9em; opacity: 0.9;">spolehlivost</div>
                        </div>
                    </div>
                    
                    <div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 8px;">
                        <h5 style="margin: 0 0 10px 0;">💡 Doporučení:</h5>
                        <ul style="margin: 0; padding-left: 20px;">
                            <li>Objednejte 180 donutů + 10% rezervu (198 ks)</li>
                            <li>Zaměřte se na čokoládové a glazované varianty</li>
                            <li>Připravte platební terminál pro vyšší tržby</li>
                            <li>Při dešti v úterý snižte množství o 30%</li>
                        </ul>
                    </div>
                </div>
        }
    }
    
  
</body>
</html>
